{"version":3,"sources":["core/src/service/dynamic-form-relation.service.ts"],"names":[],"mappings":"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","file":"dynamic-form-relation.service.js","sourcesContent":["import {Injectable} from \"@angular/core\";\nimport {FormGroup, FormControl} from \"@angular/forms\";\nimport {DynamicFormControlModel} from \"../model/dynamic-form-control.model\";\nimport {\n    DynamicFormControlRelation,\n    DynamicFormControlRelationGroup,\n    DYNAMIC_FORM_CONTROL_ACTION_DISABLE,\n    DYNAMIC_FORM_CONTROL_ACTION_ENABLE,\n    DYNAMIC_FORM_CONTROL_CONNECTIVE_AND,\n    DYNAMIC_FORM_CONTROL_CONNECTIVE_OR\n} from \"../model/dynamic-form-control-relation.model\";\n\n@Injectable()\nexport class DynamicFormRelationService {\n\n    constructor() {}\n\n    findActivationRelation(relGroups: Array<DynamicFormControlRelationGroup>): DynamicFormControlRelationGroup {\n        return relGroups.find(rel => rel.action === DYNAMIC_FORM_CONTROL_ACTION_DISABLE || rel.action === DYNAMIC_FORM_CONTROL_ACTION_ENABLE);\n    }\n\n    getRelatedFormControls(model: DynamicFormControlModel, controlGroup: FormGroup): Array<FormControl> {\n\n        let controls: Array<FormControl> = [];\n\n        model.relation.forEach(relGroup => relGroup.when.forEach(rel => {\n\n            if (model.id === rel.id) {\n                throw new Error(`FormControl ${model.id} cannot depend on itself`);\n            }\n\n            let control = <FormControl> controlGroup.get(rel.id);\n\n            if (control && !controls.some(controlElement => controlElement === control)) {\n                controls.push(control);\n            }\n        }));\n\n        return controls;\n    }\n\n    isFormControlToBeDisabled(relGroup: DynamicFormControlRelationGroup, formGroup: FormGroup): boolean {\n\n        return relGroup.when.reduce((toBeDisabled: boolean, rel: DynamicFormControlRelation, index: number) => {\n\n            let control = formGroup.get(rel.id);\n\n            if (control && relGroup.action === DYNAMIC_FORM_CONTROL_ACTION_DISABLE) {\n\n                if (index > 0 && relGroup.connective === DYNAMIC_FORM_CONTROL_CONNECTIVE_AND && !toBeDisabled) {\n                    return false;\n                }\n\n                if (index > 0 && relGroup.connective === DYNAMIC_FORM_CONTROL_CONNECTIVE_OR && toBeDisabled) {\n                    return true;\n                }\n\n                return rel.value === control.value || rel.status === control.status;\n            }\n\n            if (control && relGroup.action === DYNAMIC_FORM_CONTROL_ACTION_ENABLE) {\n\n                if (index > 0 && relGroup.connective === DYNAMIC_FORM_CONTROL_CONNECTIVE_AND && toBeDisabled) {\n                    return true;\n                }\n\n                if (index > 0 && relGroup.connective === DYNAMIC_FORM_CONTROL_CONNECTIVE_OR && !toBeDisabled) {\n                    return false;\n                }\n\n                return !(rel.value === control.value || rel.status === control.status);\n            }\n\n            return false;\n\n        }, false);\n    }\n}"]}